From: Ralf Glaser <glaser@iotmaxx.de>
Date: Mon, 4 Mar 2024 09:21:34 +0000
Subject: [PATCH] add systemd config files

---
 systemd/tailscaled.defaults |  8 ++++++++
 systemd/tailscaled.service  | 24 ++++++++++++++++++++++++
 2 files changed, 32 insertions(+)
 create mode 100644 systemd/tailscaled.defaults
 create mode 100644 systemd/tailscaled.service

diff --git a/systemd/tailscaled.defaults b/systemd/tailscaled.defaults
new file mode 100644
index 000000000000..e8384a4f8209
--- /dev/null
+++ b/systemd/tailscaled.defaults
@@ -0,0 +1,8 @@
+# Set the port to listen on for incoming VPN packets.
+# Remote nodes will automatically be informed about the new port number,
+# but you might want to configure this in order to set external firewall
+# settings.
+PORT="41641"
+
+# Extra flags you might want to pass to tailscaled.
+FLAGS=""
diff --git a/systemd/tailscaled.service b/systemd/tailscaled.service
new file mode 100644
index 000000000000..05481d4482a3
--- /dev/null
+++ b/systemd/tailscaled.service
@@ -0,0 +1,24 @@
+[Unit]
+Description=Tailscale node agent
+Documentation=https://tailscale.com/kb/
+Wants=network-pre.target
+After=network-pre.target NetworkManager.service systemd-resolved.service
+
+[Service]
+EnvironmentFile=/config/etc/default/tailscaled
+ExecStartPre=/usr/sbin/tailscaled --cleanup
+ExecStart=/usr/sbin/tailscaled --state=/config/var/lib/tailscale/tailscaled.state --socket=/run/tailscale/tailscaled.sock --port=${PORT} $FLAGS
+ExecStopPost=/usr/sbin/tailscaled --cleanup
+
+Restart=on-failure
+
+RuntimeDirectory=tailscale
+RuntimeDirectoryMode=0755
+StateDirectory=tailscale
+StateDirectoryMode=0700
+CacheDirectory=tailscale
+CacheDirectoryMode=0750
+Type=notify
+
+[Install]
+WantedBy=multi-user.target
